!function(a){"use strict";function b(a,b){this.container=null,this.items=null,this.config=null,this.containerStyleCache=null,this.styleCache=null,this.timer=null,this.id=++f,this.init(a,b)}var c=function(){function a(){}return a.prototype.css2json=function(a){var b={};if(!a)return b;if(a instanceof CSSStyleDeclaration)for(var c in a)a[c].toLowerCase&&(b[a[c].toLowerCase()]=a[a[c]]);else if("string"==typeof a){a=a.split(";");for(var c in a){var d=a[c].split(":");2==d.length&&(b[d[0].toLowerCase().trim()]=d[1].trim())}}return b},a}(),d=window.WeakMap||window.MozWeakMap||(d=function(){function a(){this.keys=[],this.values=[]}return a.prototype.get=function(a){var b,c,d,e,f;for(f=this.keys,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],c===a)return this.values[b]},a.prototype.set=function(a,b){var c,d,e,f,g;for(g=this.keys,c=e=0,f=g.length;f>e;c=++e)if(d=g[c],d===a)return void(this.values[c]=b);return this.keys.push(a),this.values.push(b)},a}()),e="pinto",f=0;b.prototype={defaults:{itemClass:"pinto",itemSkipClass:"pintoskip",itemWidth:220,gapX:10,gapY:10,align:"left",fitWidth:!0,autoResize:!0,resizeDelay:50,onItemLayout:function(a,b,c){}},init:function(a,b){this.destroy(),this.container=a,this.config=b,this.styleCache=new d,this.build(),this.layout()},applyHandlers:function(){this.config.autoResize&&a(window).on("resize.pinto"+this.id,a.proxy(this.onResizeHandler,this)),this.container.on("remove",a.proxy(this.resetHandlers,this))},resetHandlers:function(){a(window).off("resize.pinto"+this.id,a.proxy(this.onResizeHandler,this)),clearTimeout(this.timer)},onResizeHandler:function(){clearTimeout(this.timer),this.timer=setTimeout(a.proxy(this.layout,this),this.config.resizeDelay)},build:function(){this.applyHandlers(),this.containerStyleCache=this.util().css2json(this.container.attr("style")),this.items=this.container.find("."+this.config.itemClass),this.items.length&&this.items.each(a.proxy(function(a,b){this.cacheStyle(b)},this)),"static"==this.container.css("position")&&this.container.css("position","relative")},layout:function(){if(this.container.is(":visible")){for(var b=this.container.innerWidth(),c=this.config.itemWidth,d=parseInt(this.config.gapX||0),e=parseInt(this.config.gapY||0),f=0,g=0;b>f&&(f+=c,b>=f);)g++,f+=d;g=Math.max(g,1);for(var h=[],i=[],j=g;j--;)h.push(0),i.push(0);f=0;var k=(g-1)*d;this.config.fitWidth?c+=Math.floor(.5+(b-k-g*c)/g):"center"===this.config.align?f+=Math.floor(.5+(b-k-g*c)>>1):"right"===this.config.align&&(f+=Math.floor(.5+(b-k-g*c))),this.items.each(a.proxy(function(b,g){var j=a(g);if(j.is(":visible")&&!j.hasClass(this.itemSkipClass)){var k=this.getSmallestIndex(i);j.css({position:"absolute",top:i[k]+"px",left:(c+d)*k+f+"px",width:c}),i[k]+=j.outerHeight()+e,"function"==typeof this.config.onItemLayout&&this.config.onItemLayout.call(this,g,k,h[k]),h[k]++}},this));var l=0;for(j=g;j--;)i[j]>l&&(l=i[j]);this.container.css({height:l})}},destroy:function(){this.resetHandlers(),this.containerStyleCache&&this.container.removeAttr("style").css(this.containerStyleCache),this.items&&this.items.each(a.proxy(function(a,b){this.resetStyle(b)},this)),this.items=null,this.config=null,this.containerStyleCache=null,this.styleCache=null,this.timer=null},sync:function(){this.items&&this.items.each(a.proxy(function(a,b){this.resetStyle(b)},this)),this.items=a("."+this.config.itemClass),this.items.length&&this.items.each(a.proxy(function(a,b){this.cacheStyle(b)},this)),this.layout()},cacheStyle:function(b){return this.styleCache.set(b,this.util().css2json(a(b).attr("style")))},resetStyle:function(b){a(b).removeAttr("style").css(this.styleCache.get(b))},getSmallestIndex:function(a){for(var b=0,c=1,d=a.length;d>c;c++)a[c]<a[b]&&(b=c);return b},util:function(){return null!=this._util?this._util:this._util=new c}},a.fn.pinto=function(c,d){return this.each(function(){var d=a(this),f=d.data(e),g=a.isPlainObject(c)?c:{};if("layout"==c){if(!f)throw Error("Calling 'layout' method on not initialized instance is forbidden");return void f.layout()}if("sync"==c){if(!f)throw Error("Calling 'sync' method on not initialized instance is forbidden");return void f.sync()}if("destroy"==c){if(!f)throw Error("Calling 'destroy' method on not initialized instance is forbidden");return d.removeData(e),void f.destroy()}if(f){var h=a.extend({},f.config,g);f.init(d,h)}else{var h=a.extend({},b.prototype.defaults,g);f=new b(d,h),d.data(e,f)}})}}(window.jQuery);
